<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.furnature.mapper.ProductMapper">

	<!--상품 리스트-->	
	<select id="productList" parameterType="hashmap" resultType="com.example.furnature.model.Product">
		SELECT *
	    FROM TBL_PRODUCT P
	    INNER JOIN TBL_PRODUCT_CATE PC ON P.PRODUCT_CATE1 = PC.CATE_NO
	    INNER JOIN TBL_PRODUCT_IMG PI ON P.PRODUCT_NO = PI.PRODUCT_NO
	    WHERE 1=1
	    <if test="keyword != null and keyword !=''">
	        AND P.PRODUCT_NAME LIKE '%' ||  #{keyword} || '%'
	    </if>
	    <if test="width != null and width != ''">
	        AND P.PRODUCT_WIDTH BETWEEN #{width}-100 AND #{width}+100
	    </if>
	    <if test="depth != null and depth != ''">
	        AND P.PRODUCT_LENGTH BETWEEN #{depth}-100 AND #{depth}+100
	    </if>
	    <if test="height != null and height != ''">
	        AND P.PRODUCT_HEIGHT BETWEEN #{height}-100 AND #{height}+100
	    </if>
	    <if test="cateNum != null and cateNum != ''">
	        AND (P.PRODUCT_CATE1 = #{cateNum} OR P.PRODUCT_CATE2 = #{cateNum})
	    </if>
	    OFFSET #{startIndex} ROWS FETCH FIRST #{outputNumber} ROWS ONLY
	</select>
	
	<!--상품 카운트-->
	<select id="productCnt" parameterType="hashmap" resultType="int">
		SELECT COUNT(*) AS CNT 
		FROM TBL_PRODUCT P
		INNER JOIN TBL_PRODUCT_CATE PC ON P.PRODUCT_CATE1 = PC.CATE_NO
		INNER JOIN TBL_PRODUCT_IMG PI ON P.PRODUCT_NO = PI.PRODUCT_NO
		WHERE 1=1
		 <if test="keyword != null and keyword !=''">
	        AND P.PRODUCT_NAME LIKE '%' ||  #{keyword} || '%'
	     </if>
		 <if test="width != null and width != ''">
	        AND P.PRODUCT_WIDTH BETWEEN #{width}-100 AND #{width}+100
	    </if>
	    <if test="depth != null and depth != ''">
	        AND P.PRODUCT_LENGTH BETWEEN #{depth}-100 AND #{depth}+100
	    </if>
	    <if test="height != null and height != ''">
	        AND P.PRODUCT_HEIGHT BETWEEN #{height}-100 AND #{height}+100
	    </if>
	     <if test="cateNum != null and cateNum != ''">
	        AND (P.PRODUCT_CATE1 = #{cateNum} OR P.PRODUCT_CATE2 = #{cateNum})
	    </if>
	</select>	
	<!-- 상품 이미지 url 모든 리스트 -->
	<select id="selectProductImg" parameterType="hashmap" resultType="com.example.furnature.model.Product">
		SELECT * FROM
		TBL_PRODUCT_IMG
	</select>
	
	<!-- 상품 페이지에서 클릭시 상세페이지에서 상품번호에 맞는 이미지 불러오기 -->
	<select id="selectProductDetail" parameterType="hashmap" resultType="com.example.furnature.model.Product">
		SELECT * FROM 
		TBL_PRODUCT P INNER JOIN TBL_PRODUCT_IMG I 
		ON P.PRODUCT_NO = I.PRODUCT_NO 
		WHERE P.PRODUCT_NO = #{productNo}
	</select>

	
	<!--카테고리 리스트-->
	<select id="cateList" parameterType="hashmap" resultType="com.example.furnature.model.Product">
		SELECT *
		FROM TBL_PRODUCT_CATE
	</select>
	
	<!-- 상품 결제 데이터_  마이페이지에서 구매내역 보려면 구매 사이즈나 개수도 넘겨줘야함-->
	<select id="productOrder" parameterType="hashmap" resultType="com.example.furnature.model.Product">
		INSERT INTO TBL_PRODUCT_ORDER (ORDER_NO, PRODUCT_NO, USER_ID, ORDER_PRICE) 
		VALUES (#{orderNo}, #{productNo}, #{userId}, #{orderPrice})
	</select>
</mapper>
