<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.furnature.mapper.EventMapper">
	<insert id="insertAuction" parameterType="hashmap" useGeneratedKeys="true" keyProperty="auctionNo" keyColumn="AUCTION_NO">
		INSERT INTO TBL_AUCTION
		VALUES (AUCTION_SEQ.NEXTVAL, #{title}, #{price}, #{id}, TO_DATE(#{startDay}, 'YYYY-MM-DD HH24:MI:SS'), TO_DATE(#{endDay}, 'YYYY-MM-DD HH24:MI:SS'), SYSDATE, SYSDATE, #{contents}, 'test')
	</insert>
	
	<insert id="insertAuctionImg" parameterType="hashmap">
		INSERT INTO TBL_AUCTION_IMG
		VALUES (AUCTION_IMG_SEQ.NEXTVAL, #{auctionNo}, #{auctionImgName}, #{auctionImgOrgName}, #{auctionImgSize}, #{auctionImgPath})
	</insert>
	
	<update id="updataAuctionPath" parameterType="hashmap">
		UPDATE TBL_AUCTION
		SET AUCTION_CONTENTS_IMG_PATH = #{auctionContentsImgPath}
		WHERE AUCTION_NO = #{auctionNo}
	</update>
	
	<select id="selectAuctionList" parameterType="hashmap" resultType="com.example.furnature.model.Event">
		SELECT A.*, I.AUCTION_IMG_PATH
		FROM TBL_AUCTION A
		INNER JOIN (
		    SELECT AUCTION_IMG_PATH, AUCTION_NO
		    FROM (
		        SELECT ROW_NUMBER() OVER (PARTITION BY AUCTION_NO ORDER BY AUCTION_NO) RN, AUCTION_IMG_PATH, AUCTION_NO
		        FROM TBL_AUCTION_IMG
		        ORDER BY AUCTION_NO DESC
		    ) 
		    WHERE RN = 1
		    OFFSET 0 ROWS FETCH NEXT 4 ROWS ONLY
		) I ON A.AUCTION_NO = I.AUCTION_NO
		ORDER BY A.AUCTION_NO DESC 
		OFFSET 0 ROWS FETCH NEXT 4 ROWS ONLY
	</select>
	
	<select id="selectUser" parameterType="hashmap" resultType="com.example.furnature.model.Event">
		SELECT *
		FROM TBL_USER
	</select>
	
</mapper>
