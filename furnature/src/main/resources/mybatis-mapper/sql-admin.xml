<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.furnature.mapper.AdminMapper">
	<select id="selectUserList" parameterType="hashmap" resultType="com.example.furnature.model.Admin">
		SELECT 
		    USER_ID, USER_NAME, USER_ADDR, USER_PHONE, USER_EMAIL,
		    TO_CHAR(USER_BIRTH, 'YYYY-MM-DD') USER_BIRTH,
		    CASE WHEN USER_AUTH = '2' THEN '관리자'
		         ELSE '일반회원'
		    END USER_AUTH,
		    CASE WHEN EVENT_ROUL = 'Y' THEN '참여가능'
		         ELSE '참여완료'
		    END EVENT_ROUL            
		FROM TBL_USER
		WHERE 1=1 
		<if test="keyword != null and keyword != ''">
			AND USER_NAME LIKE '%' || #{keyword} || '%'
		</if>
		ORDER BY USER_AUTH ASC, USER_NAME
		OFFSET #{currentPage} ROWS FETCH FIRST #{pageSize} ROWS ONLY
	</select>
	
	<select id="selectAllUser" parameterType="hashmap" resultType="com.example.furnature.model.Admin">
		SELECT COUNT(*) ALL_USER
		FROM TBL_USER
		WHERE 1=1 
		<if test="keyword != null and keyword != ''">
			AND USER_NAME LIKE '%' || #{keyword} || '%'
		</if>
	</select>
	
	<delete id="deleteUserList" parameterType="hashmap">
		DELETE FROM TBL_USER
		WHERE USER_ID IN
		<foreach collection="removeList" item="item" open="(" close=")" separator=",">
			 #{item}
		</foreach>
	</delete>
	
	<update id="updateUser" parameterType="hashmap">
		UPDATE TBL_USER
		<set>
			<if test="phone != null and phone != ''">USER_PHONE = #{phone},</if>
			<if test="email != null and email != ''">USER_EMAIL = #{email},</if>
		</set>
		WHERE USER_ID = #{id}
	</update>
</mapper>
